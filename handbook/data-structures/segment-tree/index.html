<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.6.0.790003396282">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.6.0">

    <!-- Primary Meta Tags -->
    <title>C&#226;y ph&#226;n đoạn (Segment Tree) | ChuyentinORZ Wiki</title>
    <meta name="title" content="Cây phân đoạn (Segment Tree) | ChuyentinORZ Wiki">
    <meta name="description" content="Quay lại với bài toán ở phần bảng thưa:">

    <!-- Canonical -->
    <link rel="canonical" href="/handbook/data-structures/segment-tree/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="/handbook/data-structures/segment-tree/">
    <meta property="og:title" content="Cây phân đoạn (Segment Tree) | ChuyentinORZ Wiki">
    <meta property="og:description" content="Quay lại với bài toán ở phần bảng thưa:">
    <meta property="og:image" content="/images/segment_tree_build.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="/handbook/data-structures/segment-tree/">
    <meta property="twitter:title" content="Cây phân đoạn (Segment Tree) | ChuyentinORZ Wiki">
    <meta property="twitter:description" content="Quay lại với bài toán ở phần bảng thưa:">
    <meta property="twitter:image" content="/images/segment_tree_build.png">

    <script data-cfasync="false">(function () { var el = document.documentElement, m = localStorage.getItem("doc_theme"), wm = window.matchMedia; if (m === "dark" || (!m && wm && wm("(prefers-color-scheme: dark)").matches)) { el.classList.add("dark") } else { el.classList.remove("dark") } })();</script>

    <link href="../../../logo.png" rel="icon">
    <link href="../../../resources/css/retype.css?v=3.6.0.790003396282" rel="stylesheet">

    <script data-cfasync="false" src="../../../resources/js/config.js?v=3.6.0.790003396282" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../../../resources/js/retype.js?v=3.6.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../../../resources/js/lunr.js?v=3.6.0.790003396282" data-turbo-eval="false" defer></script>
    <script id="prism-js" data-cfasync="false" src="../../../resources/js/prism.js?v=3.6.0.790003396282" defer></script>
    <link href="../../../resources/css/katex.css?v=3.6.0" rel="stylesheet">
    <script id="katex-js" data-cfasync="false" src="../../../resources/js/katex.js?v=3.6.0" defer></script>
</head>
<body>
    <div id="docs-app" class="relative text-base antialiased text-gray-700 bg-white font-body dark:bg-dark-850 dark:text-dark-300">
        <div class="absolute bottom-0 left-0 bg-gray-100 dark:bg-dark-800" style="top: 5rem; right: 50%"></div>
    
        <header id="docs-site-header" class="sticky top-0 z-30 flex w-full h-16 bg-white border-b border-gray-200 md:h-20 dark:bg-dark-850 dark:border-dark-650">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton docs-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="docs-sidebar-toggle"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="docs-site-logo" href="../../../" class="flex items-center leading-snug text-xl">
                            <span class="w-10 mr-2 grow-0 shrink-0 overflow-hidden">
                                <img class="max-h-10 dark:hidden md:inline-block" src="../../../logo.png">
                                <img class="max-h-10 hidden dark:inline-block" src="../../../logo.png">
                            </span>
                            <span class="dark:text-white font-semibold line-clamp-1 md:line-clamp-2">Chuyen Tin orz</span>
                        </a><span class="hidden px-2 py-1 ml-4 text-sm font-semibold leading-none text-root-logo-label-text bg-root-logo-label-bg rounded-sm md:inline-block">v1.0.0</span>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block dark:border-dark-650"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://chuyentinorz.is-a.dev">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M11.03 2.59a1.501 1.501 0 0 1 1.94 0l7.5 6.363a1.5 1.5 0 0 1 .53 1.144V19.5a1.5 1.5 0 0 1-1.5 1.5h-5.75a.75.75 0 0 1-.75-.75V14h-2v6.25a.75.75 0 0 1-.75.75H4.5A1.5 1.5 0 0 1 3 19.5v-9.403c0-.44.194-.859.53-1.144ZM12 3.734l-7.5 6.363V19.5h5v-6.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v6.25h5v-9.403Z"/>
                                        </g>
                                    </svg>
                                    <span>Homepage</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://orz-blog.github.io">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M3.5 3.25a.75.75 0 0 1 .75-.75C14.053 2.5 22 10.447 22 20.25a.75.75 0 0 1-1.5 0C20.5 11.275 13.225 4 4.25 4a.75.75 0 0 1-.75-.75Zm.75 6.25C10.187 9.5 15 14.313 15 20.25a.75.75 0 0 1-1.5 0A9.25 9.25 0 0 0 4.25 11a.75.75 0 0 1 0-1.5ZM3.5 19a2 2 0 1 1 3.999-.001A2 2 0 0 1 3.5 19Z"/>
                                        </g>
                                    </svg>
                                    <span>Blogs</span>
                                </a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-gray-400 transition-colors duration-200 ease-in bg-gray-200 border border-transparent rounded md:text-sm hover:bg-white hover:border-gray-300 focus:outline-none focus:bg-white focus:border-gray-500 dark:bg-dark-600 dark:border-dark-600 dark:placeholder-dark-400" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="T&#236;m kiếm...">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="docs-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-gray-100 border-gray-200 sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton dark:bg-dark-800 dark:border-dark-650">
            
                <!-- Render this div, if config.showSidebarFilter is `true` -->
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-white border border-gray-200 rounded shadow-none text-sm focus:outline-none focus:border-gray-600 dark:bg-dark-600 dark:border-dark-600" type="text" placeholder="Filter">
                </div>
            
                <div class="pl-6 mt-1 mb-4">
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                </div>
            
                <div class="shrink-0 mt-auto bg-transparent dark:border-dark-650">
                    <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                        <span class="text-xs whitespace-nowrap">Powered by</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                    </a>
                </div>
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-dark-650">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-dark-650">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://chuyentinorz.is-a.dev">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M11.03 2.59a1.501 1.501 0 0 1 1.94 0l7.5 6.363a1.5 1.5 0 0 1 .53 1.144V19.5a1.5 1.5 0 0 1-1.5 1.5h-5.75a.75.75 0 0 1-.75-.75V14h-2v6.25a.75.75 0 0 1-.75.75H4.5A1.5 1.5 0 0 1 3 19.5v-9.403c0-.44.194-.859.53-1.144ZM12 3.734l-7.5 6.363V19.5h5v-6.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v6.25h5v-9.403Z"/>
                                                </g>
                                            </svg>
                                            <span>Homepage</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://orz-blog.github.io">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M3.5 3.25a.75.75 0 0 1 .75-.75C14.053 2.5 22 10.447 22 20.25a.75.75 0 0 1-1.5 0C20.5 11.275 13.225 4 4.25 4a.75.75 0 0 1-.75-.75Zm.75 6.25C10.187 9.5 15 14.313 15 20.25a.75.75 0 0 1-1.5 0A9.25 9.25 0 0 0 4.25 11a.75.75 0 0 1 0-1.5ZM3.5 19a2 2 0 1 1 3.999-.001A2 2 0 0 1 3.5 19Z"/>
                                                </g>
                                            </svg>
                                            <span>Blogs</span>
                                        </a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
            
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 dark:bg-dark-850">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div class="min-w-0 p-4 grow md:px-16">
                        <main class="relative pb-12 lg:pt-2">
                            <div class="docs-markdown" id="docs-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="docs-sidebar-right-toggle"></div>
                                <!-- Page content  -->
<doc-anchor-target id="cây-phân-đoạn-segment-tree" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cây-phân-đoạn-segment-tree">#</doc-anchor-trigger>
        <span>Cây phân đoạn (Segment Tree)</span>
    </h1>
</doc-anchor-target>
<p>Quay lại với bài toán ở phần <a href="../sparse-table/">bảng thưa</a>:</p>
<blockquote>
<p>Cho một mảng <code v-pre>a</code> có <span class="math">n</span> phần tử và <span class="math">q</span> truy vấn có dạng <code v-pre>(l, r)</code>. Với mỗi truy vấn, tìm và in ra giá trị nhỏ nhất (GTNN) của các phần tử trong khoảng <span class="math">[l, r]</span>.</p>
</blockquote>
<p>Mảng <code v-pre>a</code> ví dụ:</p>
<p><span class="math">a = [5, 2, 7, 8, 3, 1, 4, 6]</span></p>
<p>Nếu như các truy vấn chỉ yêu cầu ta tìm GTNN của các đoạn thì bảng thưa là một lựa chọn phù hợp để giải quyết bài toán. Tuy nhiên nếu bài toán có thêm các truy vấn yêu cầu thay đổi giá trị của các phần tử trong mảng, thì ta cần phải cập nhật phần tử và xây dựng lại bảng thưa, khiến cho bảng thưa không còn hiệu quả.</p>
<p>Ta sẽ nói về CTDL <strong>Cây phân đoạn (Segment Tree)</strong> - một CTDL linh hoạt giúp giải quyết bài toán này.</p>
<doc-anchor-target id="tư-tưởng">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#tư-tưởng">#</doc-anchor-trigger>
        <span>Tư tưởng</span>
    </h2>
</doc-anchor-target>
<p>Giả sử bạn muốn đo chiều cao của tất cả học sinh trong một khu vực.</p>
<p>Một điều chắc chắn là ta không thể đến và đo chiều cao của tất cả học sinh trong khu vực ấy được - nó tốn quả nhiều thời gian và không hề hiệu quả. Thay vì thế, ta có thể bàn giao công việc này cho các trường trong khu vực, mỗi trường đó lại để giáo viên chủ nhiệm đo chiều cao của các em học sinh trong lớp và báo cáo lại để nhà trường tổng hợp lại.</p>
<p>Khi này, thay vì kiểm tra tất cả học sinh ấy thì ta chỉ cần thu thập thông tin tổng hợp từ các trường. Điều này giúp ta thu thập thông tin nhanh hơn và hiệu quả hơn.</p>
<p>Đây chính là ý tưởng chính cho CTDL Segment Tree: Chia một không gian quản lí lớn thành các không gian quản lí nhỏ hơn - một giải pháp <a href="../../algo-paradigms/dnc/">chia để trị</a>.</p>
<doc-anchor-target id="segment-tree">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#segment-tree">#</doc-anchor-trigger>
        <span>Segment Tree</span>
    </h2>
</doc-anchor-target>
<p>Segment tree là một <a href="../../graph-theory/overview/#c%C3%A2y">cây</a>, chính xác hơn là một cây nhị phân đầy đủ - mỗi đỉnh hoặc là một đỉnh lá hoặc có hai đỉnh con. Ta sẽ lưu segment tree trên một mảng <code v-pre>st</code> với chỉ số <span class="math">1</span> đại diện cho gốc của cây. Với mỗi chỉ số <span class="math">p</span>, <span class="math">2 \times p</span> và <span class="math">2 \times p + 1</span> là hai chỉ số của hai đỉnh con của nó.</p>
<p>Mỗi đỉnh của cây sẽ lưu thông tin về một phân đoạn trên mảng <code v-pre>a</code>. Gốc của Segment Tree tượng trưng cho đoạn <span class="math">[1, n]</span>. Với mỗi đỉnh <span class="math">p</span> lưu thông tin về đoạn <span class="math">[l, r]</span>. Nếu <span class="math">p</span> không phải là đỉnh lá thì hai đỉnh con <span class="math">2 \times p</span> và <span class="math">2 \times p + 1</span> sẽ lần lượt lưu thông tin của hai đoạn <span class="math">[l, \left\lfloor (l + r) / 2 \right\rfloor]</span> và <span class="math">[\left\lfloor(l + r) / 2\right\rfloor + 1, r]</span>. Nếu <span class="math">p</span> là đỉnh lá thì nó chỉ quản lý đúng một phần tử duy nhất trên mảng <code v-pre>a</code> có chỉ số <span class="math">l = r</span>.</p>
<doc-anchor-target id="xây-dựng-segment-tree">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#xây-dựng-segment-tree">#</doc-anchor-trigger>
        <span>Xây dựng segment tree</span>
    </h2>
</doc-anchor-target>
<p>Để xây dựng segment tree, ta có hàm đệ quy <code v-pre>build(p, l, r)</code>.</p>
<p>Hàm <code v-pre>build(p, l, r)</code> của ta hoạt động như sau:</p>
<ul>
<li>Nếu <span class="math">l = r</span>, giá trị nhỏ nhất của đoạn <span class="math">[l, r]</span> chính là phần tử <span class="math">a[l]</span>: <span class="math">st[p] = a[l]</span>.</li>
<li>Nếu <span class="math">l \neq r</span>, ta sẽ tính một cách đệ quy GTNN của hai đỉnh con và tính giá trị của đỉnh <span class="math">p</span> từ giá trị của hai đỉnh con: <span class="math">st[p] = min(st[p \times 2], st[p \times 2 + 1])</span>.</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-cpp"><code v-pre class="language-cpp">void build(int p, int l, int r){
	if(l == r){
		// Đỉnh lá
		st[p] = a[l];
		return;
	}

	int mid = (l + r) &gt;&gt; 1;
	// Tính giá trị hai đỉnh con
	build(p &lt;&lt; 1, l, mid);
	build(p &lt;&lt; 1 | 1, mid + 1, r);
	
	// Tính giá trị từ hai đỉnh con
	st[p] = min(st[p &lt;&lt; 1], st[d &lt;&lt; 1 | 1]);
}</code></pre>
</doc-codeblock></div>
<p>Ta xây dựng segment tree bằng cách gọi <code v-pre>build(1, 1, n)</code>.</p>
<p><figure class="content-center">
    <img src="../../../images/segment_tree_build.png" alt="Segment Tree Build">
    <figcaption class="caption">Segment Tree Build</figcaption>
</figure>
</p>
<p>Ta có thể thấy số lượng đỉnh cần tính sẽ là độ phức tạp của việc xây dựng segment tree. Ta có thể tính được số lượng đỉnh trong segment tree sẽ không vượt quá <span class="math">4n</span>, nên độ phức tạp thuật toán và không gian sẽ bằng <span class="math">O(4n) \approx O(n)</span>.</p>
<doc-anchor-target id="trả-lời-truy-vấn">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#trả-lời-truy-vấn">#</doc-anchor-trigger>
        <span>Trả lời truy vấn</span>
    </h2>
</doc-anchor-target>
<p>Ta xử lí các truy vấn yêu cầu ta tìm GTNN của một đoạn <span class="math">[l, r]</span> bằng cách sử dụng các đoạn đã được tính trước.</p>
<p>Giả sử ta đang ở đỉnh <span class="math">p</span> lưu GTNN của đoạn <span class="math">[u, v]</span>, ta sẽ tính kết quả như sau:</p>
<ul>
<li>Nếu <span class="math">[u, v]</span> nằm hoàn toàn bên trong <span class="math">[l, r]</span> (<span class="math">l \le u \le v \le r</span>), ta trả về GTNN lưu trong đỉnh <span class="math">p</span>.</li>
<li>Nếu <span class="math">[u, v]</span> nằm hoàn toàn bên ngoài <span class="math">[l, r]</span> (<span class="math">v &lt; l</span> hoặc <span class="math">r &lt; u</span>), ta bỏ qua GTNN lưu trong <span class="math">p</span>.</li>
<li>Nếu một phần <span class="math">[u, v]</span> nằm bên trong <span class="math">[l, r]</span>, ta sẽ tính được GTNN từ hai đỉnh con bằng cách áp dụng các bước ở trên và kết hợp GTNN trả về từ hai đỉnh ấy.</li>
</ul>
<p>Ta tính GTNN của đoạn <span class="math">[l, r]</span> bằng việc xuất phát từ đỉnh <span class="math">1</span> và thực hiện các bước ở trên</p>
<p>Hình dưới đây minh họa thao tác trả lời truy vấn tìm GTNN của đoạn <span class="math">[3, 7]</span>.</p>
<p><figure class="content-center">
    <img src="../../../images/segment_tree_answer.png" alt="Segment Tree Answer">
    <figcaption class="caption">Segment Tree Answer</figcaption>
</figure>
</p>
<p>Sau khi thực hiện tìm GTNN, thuật toán của ta trả về GTNN của các đoạn <span class="math">[3, 4]</span>, <span class="math">[5, 6]</span> và <span class="math">[7, 7]</span> có GTNN lần lượt là <span class="math">7</span>, <span class="math">1</span> và <span class="math">4</span>. Kết hợp các kết quả này lại và ta có kết quả của đoạn <span class="math">[3, 7]</span> bằng <span class="math">min([3, 7]) = min([3, 4], [5, 6], [7, 7]) = min(7, 1, 4) = 1</span>.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-cpp"><code v-pre class="language-cpp">int ans(int id, int l, int r, int u, int v){
	if(v &lt; l || r &lt; u) return INT_MAX; // Trả về giá trị không làm ảnh hưởng kết quả
	if(u &lt;= l &amp;&amp; r &lt;= v) return st[id];
	int mid = (l + r) &gt;&gt; 1;
	return min(ans(id &lt;&lt; 1, l, mid, u, v), ans(id &lt;&lt; 1 | 1, mid + 1, r, u, v));
}</code></pre>
</doc-codeblock></div>
<p>Để tìm GTNN của phân đoạn <span class="math">[l, r]</span>, ta gọi <code v-pre>ans(1, 1, n, l, r)</code>.</p>
<p>Độ phức tạp thuật toán sẽ là <span class="math">O(\log{n})</span>.</p>
<doc-anchor-target id="cập-nhật-giá-trị">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cập-nhật-giá-trị">#</doc-anchor-trigger>
        <span>Cập nhật giá trị</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="cập-nhật-điểm">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cập-nhật-điểm">#</doc-anchor-trigger>
        <span>Cập nhật điểm</span>
    </h3>
</doc-anchor-target>
<p>Đối với các truy vấn yêu cầu ta thay đổi giá trị của một phần tử trong mảng, ta cập nhật phần tử ấy và tính toán lại các phân đoạn phụ thuộc vào phần tử đó.</p>
<p><figure class="content-center">
    <img src="../../../images/segment_tree_point_update.png" alt="Segment Tree Point Update">
    <figcaption class="caption">Segment Tree Point Update</figcaption>
</figure>
</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-cpp"><code v-pre class="language-cpp">// u: chỉ số phần tử cần cập nhật
// v: giá trị cập nhật
void update(int id, int l, int r, int u, int v){
	if(l == r){
		st[id] = v;
		return;
	}
	int mid = (l + r) &gt;&gt; 1;
	if(u &lt;= mid) update(id &lt;&lt; 1, l, mid, u, v);
	else update(id &lt;&lt; 1 | 1, mid + 1, r, u, v);
	st[id] = min(st[id &lt;&lt; 1], st[id &lt;&lt; 1 | 1]);
}</code></pre>
</doc-codeblock></div>
<p>Để cập nhật giá trị của phần tử thứ <span class="math">i</span> thành <span class="math">x</span> , ta gọi <code v-pre>update(1, 1, n, i, x)</code>.</p>
<p>Thuật toán của ta sẽ đi qua số lượng đỉnh bằng với chiều cao của cây nên có độ phức tạp <span class="math">O(\log{n})</span>.</p>
<doc-anchor-target id="cập-nhật-đoạn">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cập-nhật-đoạn">#</doc-anchor-trigger>
        <span>Cập nhật đoạn</span>
    </h3>
</doc-anchor-target>
<p>Đối với cập nhật đoạn, ta cần một cách xử lí thông minh hơn.</p>
<p>Giả sử ta áp dụng cách cập nhật đoạn tương tự cách làm với cập nhật điểm, số lượng phân đoạn ta cần cập nhật có thể lên đến <span class="math">O(n)</span>.</p>
<p>Nếu ta cập nhật: &quot;thay đổi các phần tử trong khoảng <span class="math">[2, 7]</span> thành <span class="math">9</span>&quot;:</p>
<p><figure class="content-center">
    <img src="../../../images/segment_tree_range_update.png" alt="Segment Tree Range Update">
    <figcaption class="caption">Segment Tree Range Update</figcaption>
</figure>
</p>
<p>Có thể thấy thao tác cập nhật <span class="math">O(n)</span> này thì sẽ không hề hiệu quả. Vậy làm sao để khắc phục nhược điểm này?</p>
<doc-anchor-target id="cập-nhật-lười">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cập-nhật-lười">#</doc-anchor-trigger>
        <span>Cập nhật lười</span>
    </h3>
</doc-anchor-target>
<p><strong>Cập nhật lười</strong>, hay <strong>lazy propagation</strong>, là một kĩ thuật giúp ta thực hiện truy vấn cập nhật đoạn hiệu quả trên segment tree.</p>
<p>Giả sử ta thực hiện cập nhật phân đoạn trên một đỉnh, ta sẽ lưu cập nhật này và không cập nhật đỉnh ấy.</p>
<p><figure class="content-center">
    <img src="../../../images/lazy_propagation.png" alt="Lazy Propagation">
    <figcaption class="caption">Lazy Propagation</figcaption>
</figure>
</p>
<p>Chỉ khi đỉnh này được xét đến thì ta mới thực hiện cập nhật giá trị trên đỉnh ấy mà ta đã lưu. Sau khi cập nhật xong thì ta lưu cập nhật lên các đỉnh con và xóa thông tin cập nhật trên đỉnh này.</p>
<p><figure class="content-center">
    <img src="../../../images/lazy_propagation_applied.png" alt="Lazy Propagation Applied">
    <figcaption class="caption">Lazy Propagation Applied</figcaption>
</figure>
</p>
<p>Bằng cách này, ta có thể giảm số lượng đỉnh mà ta cần đến khi cập nhật.</p>
<p><figure class="content-center">
    <img src="../../../images/segment_tree_lazy_propagation.png" alt="Seg,emt Tree Lazy Propagation">
    <figcaption class="caption">Seg,emt Tree Lazy Propagation</figcaption>
</figure>
</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-cpp"><code v-pre class="language-cpp">void lazy(int id, int l, int r){
	// nếu đỉnh id không lưu bất kì truy vấn cập nhật nào
	if(lz[id] == -1) return;
	st[id] = lz[id];
	if(l != r) { // nếu đỉnh id không phải đỉnh lá
		lz[id &lt;&lt; 1] = lz[id &lt;&lt; 1 | 1] = lz[id];
	}
	lz[id] = -1;
}
// cập nhật các phần tử khoảng [u, v] thành x
void update(int id, int l, int r, int u, int v, int x){
	lazy(id, l, r);
	if(v &lt; l || r &lt; u) return;
	if(u &lt;= l &amp;&amp; r &lt;= v){
		lz[id] = x;
		lazy(id, l, r);
		return;
	}
	int mid = (l + r) &gt;&gt; 1;
	update(id &lt;&lt; 1, l, mid, u, v, x);
	update(id &lt;&lt; 1 | 1, mid + 1, r, u, v, x);
	st[id] = min(st[id &lt;&lt; 1], st[id &lt;&lt; 1 | 1]);
}</code></pre>
</doc-codeblock></div>
<p>Để cập nhật giá trị của các phần tử từ <span class="math">l</span> đến <span class="math">r</span> thành <span class="math">x</span> , ta gọi <code v-pre>update(1, 1, n, l, r, x)</code>.</p>
<p>Độ phức tạp của truy vấn cập nhật đoạn giờ đây giảm xuống còn <span class="math">O(\log{n})</span>.</p>
<p>Ta cũng cần sửa lại hàm <code v-pre>ans</code> khi áp dụng cập nhật lười.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-cpp"><code v-pre class="language-cpp">int ans(int id, int l, int r, int u, int v){
	lazy(id, l, r);
	if(v &lt; l || r &lt; u) return INT_MAX;
	if(u &lt;= l &amp;&amp; r &lt;= v) return st[id];
	int mid = (l + r) &gt;&gt; 1;
	return min(ans(id &lt;&lt; 1, l, mid, u, v), ans(id &lt;&lt; 1 | 1, mid + 1, r, u, v));
}</code></pre>
</doc-codeblock></div>
<p>Độ phức tạp của hàm <code v-pre>ans</code> không thay đổi: <span class="math">O(\log{n})</span>.</p>

                                <div class="flex items-center mt-6 mb-6 clear-both">
                                    <span>
                                        <a href="../../../tags/">
                                            <svg class="inline-block -mb-px mr-1.5 text-blue-500 dark:text-blue-400" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" overflow="visible" fill="currentColor"><g><path d="M21.3 9.88l-8.59-8.59C12.52 1.11 12.27 1 12 1H2c-.55 0-1 .45-1 1v10c0 .27.11.52.29.71l8.59 8.58c.57.57 1.32.88 2.12.88s1.55-.31 2.12-.88l7.17-7.17a3.009 3.009 0 00.01-4.24zm-1.42 2.82l-7.17 7.17c-.39.39-1.02.39-1.42 0L3 11.59V3h8.59l8.29 8.29c.39.39.39 1.03 0 1.41z" /><path d="M7.01 6C6.45 6 6 6.45 6 7s.45 1 1 1 1-.45 1-1-.44-1-.99-1z" /></g></svg>
                                        </a>
                                        <span class="mr-2"><a href="../../../tags/c%E1%BA%A5u-tr%C3%BAc-d%E1%BB%AF-li%E1%BB%87u/" class="no-link inline-flex align-middle items-center justify-center font-medium leading-none whitespace-nowrap text-blue-500 dark:text-blue-400 border border-blue-500 dark:border-blue-400 hover:bg-blue-100 dark:hover:bg-transparent dark:hover:border-blue-200 dark:hover:text-blue-200 transition-colors duration-200 ease-out h-6 px-2 text-xs rounded-md">
                                    <span>cấu trúc dữ liệu</span>
                                </a></span>
                                        <span class="mr-2"><a href="../../../tags/c%C3%A2y-ph%C3%A2n-%C4%91o%E1%BA%A1n/" class="no-link inline-flex align-middle items-center justify-center font-medium leading-none whitespace-nowrap text-blue-500 dark:text-blue-400 border border-blue-500 dark:border-blue-400 hover:bg-blue-100 dark:hover:bg-transparent dark:hover:border-blue-200 dark:hover:text-blue-200 transition-colors duration-200 ease-out h-6 px-2 text-xs rounded-md">
                                    <span>cây phân đoạn</span>
                                </a></span>
                                        <span class="mr-2"><a href="../../../tags/segment-tree/" class="no-link inline-flex align-middle items-center justify-center font-medium leading-none whitespace-nowrap text-blue-500 dark:text-blue-400 border border-blue-500 dark:border-blue-400 hover:bg-blue-100 dark:hover:bg-transparent dark:hover:border-blue-200 dark:hover:text-blue-200 transition-colors duration-200 ease-out h-6 px-2 text-xs rounded-md">
                                    <span>segment tree</span>
                                </a></span>
                                        <span class="mr-2"><a href="../../../tags/competitive-programming/" class="no-link inline-flex align-middle items-center justify-center font-medium leading-none whitespace-nowrap text-blue-500 dark:text-blue-400 border border-blue-500 dark:border-blue-400 hover:bg-blue-100 dark:hover:bg-transparent dark:hover:border-blue-200 dark:hover:text-blue-200 transition-colors duration-200 ease-out h-6 px-2 text-xs rounded-md">
                                    <span>competitive programming</span>
                                </a></span>
                                        <span class="mr-2"><a href="../../../tags/cp/" class="no-link inline-flex align-middle items-center justify-center font-medium leading-none whitespace-nowrap text-blue-500 dark:text-blue-400 border border-blue-500 dark:border-blue-400 hover:bg-blue-100 dark:hover:bg-transparent dark:hover:border-blue-200 dark:hover:text-blue-200 transition-colors duration-200 ease-out h-6 px-2 text-xs rounded-md">
                                    <span>cp</span>
                                </a></span>
                                    </span>
                                </div>
                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                            </div>
                            <footer class="clear-both">
                            
                                <nav class="flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../../../handbook/data-structures/sparse-table/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-gray-400 dark:text-dark-400">Previous</span>
                                                <span class="block mt-1">Bảng thưa (Sparse Table)</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../../../handbook/data-structures/fenwick/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-gray-400 dark:text-dark-400">Next</span>
                                                <span class="block mt-1">Cây chỉ số nhị phân - Cây Fenwick (Fenwick Tree)</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div class="border-t dark:border-dark-650 pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between">
                                <div>
                                    <ul class="flex flex-wrap items-center text-sm">
                                        <li>
                                            <a class="block mr-4 py-2 text-sm whitespace-nowrap transition-colors duration-200 ease-linear text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200 md:mb-0" href="https://akk1to.is-a.dev">Visit akk1to.dev website</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="docs-copyright py-2 text-gray-500 dark:text-dark-350 text-sm leading-relaxed"><p>© Copyright 2025 ChuyentinORZ &amp; akk1to.dev. All rights reserved.</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-white border-gray-200 lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton dark:bg-dark-850 dark:border-dark-650">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="docs-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "Cây phân đoạn (Segment Tree)", level: 3, icon: "file", hasPrism: true, hasMermaid: false, hasMath: true, tocDepth: 23 }</script>
</body>
</html>
